# 3장 테이블 설계와 릴레이션  

## 3.1 데이터 모델링 기술의 중요성  

데이터를 사용하는 방식에 따라서 데이터를 설계가 달라지기 때문에 정석은 없다. 그래도 어플리케이션을 만들 때는 '어떤 데이터가 필요한지' 제대로 파악하고 만드는게 중요하다. 이미 확정된 설계에서 수정을 가하는 것은 힘들기 때문이다. 근데 어플리케이션 개발을 하다보면, 처음부터 어떤 데이터가 필요한지 식별하는 것은 힘들다. 운영을 하면서 요구사항에 이해가 깊어지고나면 그때서야 필요한 데이터를 알게 될 수도 있기 때문에 수정이 용이한 디자인을 하는 것이 중요다. (근데 이게 말이 쉽지..)  

## 3.2 예제를 사용하여 생각해 보자  

데이터의 양에 따라서 관리 방식이 달라진다. 데이터의 양이 많을때만 데이터베이스를 써야한다고 생각할 수 있는데, 그렇지 않다. 데이터 양이 적더라도, 데이터를 보관하는 방식에 따라 일관성이 무너질 수 있다. 한번 일관성이 틀어지면 이를 보정하는데 많은 리소스가 소요된다. ~~어떤 시나리오에서 일관성이 무너질 수 있는지 생각해보고, 이를 대비하기 위해 데이터베이스를 사용한다.~~  

기본키 : 행을 고유하게 식별하기 위한 키  
생각나는대로 설계해서 데이터를 때려 넣었더니, 부서 정보, 부서 전화번호 등의 정보에서 중복이 발생하였다.  

## 3.3 포인트 1 : 테이블 관계를 도입  

테이블에 중복된 정보가 여러 번 들어가는 경우를 생각해보자. 만약 사람이 그 정보를 입력한다고 했을 때 실수할 수 있고, 그 정보에 변화가 생겼을 때, 변경이 필요한 부분을 모두 찾아서 바꿔야한다. 그래서 중복/반복되는 정보는 다른 테이블로 만들어서 관계를 설정한다. 두 테이블 사이에 관계가 형성되었으면, 사람이 데이터를 잘못 입력했을 경우에도 **참조 무결성 제약 (외래 키 제약)** 에 따라서 에러가 나게 된다.  
하지만 참조 무결성 제약은 동일 서버의 DB에 있는 테이블끼리 적용이 가능하고, DB가 여러 서버에 분리되어 있으면 참조 무결성 제약을 사용할 수 없다. 그러면 이 역할은 **어플리케이션**에서 구현해야 한다.  
그리고 각 테이블을 참조하는 것은 매우 고속으로 처리해야하기 때문에 당연하게도, 외래 키에는 인덱스 설정이 필수이다.  

## 3.4 포인트 2 : 테이블 설계의 타당성 검증하기  

만약에 1:N 관계를 정의하려면 어떻게 해야할까? 한 사람이 여러 부서에 속할 수 있다는 요구사항이 있을 때 어떻게 설계할 것인가?  

1. 예약 column을 둔다. (부서1, 부서2, 부서3... 기본 값은 NULL)

    - 굉장히 비효율적인 방법이다. 물리적인 공간 낭비가 심하다.
    - 예약 column을 어디까지 둘 것인지 명확하지 않은 경우가 많다. 나중에 추가하는 것도 쉽지 않다.

1. SET 형태로 한 column에 여러 값을 넣는다

    - 정수로 취급 못하고 문자열이 됨.
    - SET 형식 자체가 지원 안되는 경우가 많다.
    - SET 형식 자체가 인덱싱하기 어렵다.

1. 매핑테이블을 만든다.

    - 기본 키 값이 자주 바뀐다.
    - 레코드 수가 많아진다.

## 3.5 정규화 이론의 기본을 파악해두자  

### 1 정규형도 아닌 것  

중복/반복 값, 복합 값 (한 column에 여러 값) 포함  

-> 모든 column의 값이 원자 값으로만 구성되어 있으면 *제1정규형*에 속한다.  

### 2 정규형이 아닌 것  

기본 키가 여러 열로 구성되어 있고, 기본키의 일부 열의 값에 의해서만 값이 결정되는 열이 있다면 2 정규형이 아님  
ex) KEY : (사원 번호, 부서 번호) 에 부서 이름이 있다면, 부서 이름은 부서 번호만 알고 있으면 결정되는 값이다.

-> 제1정규형에 속하면서 기본키가 아닌 모든 속성이 기본키에 완전 함수 종속되면 *제2정규형*이다.
-> 제2정규형도 삽입, 갱신, 삭제 이상은 계속해서 나옴.. 왜냐하면 이행적 함수 종속(Transitive Functional Dependency)이 존재하기 때문이다.

### 3 정규형이 아닌 것  

원칙적으로 테이블의 모든 column은 key 에 의해서 값이 결정되어야 한다. 그렇지 않으면 일관성이 없는 문제가 발생한다.  

-> 제2정규형에 속하면서 기본키가 아닌 모든 속성이 기본키에 이행적 함수 종속이 되지 않으면 제3정규형이다. (삼단 논법 ㄴㄴ)  

> X, Y, Z 에 대해서 X -> Y, Y -> Z 면 X -> Z 가 된다.  
> 학번 -> 학부  
> 학부 -> 등록금  
> 학번 -> 등록금  
> 학부에 따라서 등록금이 결정되는 것이지, 학번에 따라서 등록금이 결정되는게 아니다.  
> 이런 경우엔 [X, Y], [Y, Z] 두 테이블로 분리하면 된다.

-> 제3정규형을 만족하더라도 이상현상이 없어지진 않는다.  
